services:

  micro_ros_agent:
    build: ./micro_ros_agent
    container_name: micro_ros_agent
    restart: always
    user: "${UID:-1000}:${GID:-1000}"
    group_add:
      - dialout
    devices:
      - /dev/ttyACM1:/dev/ttyACM1
    privileged: true 
    network_mode: host 
    volumes:
      - /dev/shm:/dev/shm
    environment:
      - ROS_DOMAIN_ID=0

  joy_node:
    build: ./joystick_driver_node
    container_name: joy_linux
    restart: always
    user: "${UID:-1000}:${GID:-1000}"
    volumes:
      - /dev/input:/dev/input:ro
      - /dev/shm:/dev/shm
    network_mode: host
    privileged: true
    environment:
      - ROS_DOMAIN_ID=0
    depends_on:
      - micro_ros_agent

  foxglove_bridge_agent:
    build: ./foxglove_bridge_agent
    container_name: foxglove_bridge_agent
    restart: always
    user: "${UID:-1000}:${GID:-1000}"
    network_mode: host
    privileged: false
    volumes:
      - /dev/shm:/dev/shm
    environment:
      - ROS_DOMAIN_ID=0
    depends_on:
      - joy_node
